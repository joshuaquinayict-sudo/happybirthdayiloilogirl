<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>For Someone Special ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* UI design preserved / restored */
        :root{
            --accent-from:#ec4899;
            --accent-to:#f43f5e;
        }

        body{
            margin:0;
            height:100vh;
            overflow:hidden;
            font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(135deg,#f9a8d4,#f3e8ff);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        #app{
            position:relative;
            width:100%;
            height:100%;
            overflow:hidden;
        }

        #canvas-container{
            position:fixed;
            inset:0;
            z-index:1;
        }

        #content{
            position:relative;
            z-index:20;
            width:100%;
            height:100%;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px;
            box-sizing:border-box;
        }

        .step{
            position:absolute;
            width:100%;
            max-width:880px;
            margin:0 auto;
            left:50%;
            transform:translate(-50%,20px);
            padding:36px;
            background:rgba(255,255,255,0.55);
            backdrop-filter:blur(8px);
            border-radius:20px;
            box-shadow:0 12px 40px rgba(16,24,40,0.12);
            text-align:center;
            opacity:0;
            transition:all .6s cubic-bezier(.16,1,.3,1);
            pointer-events:none;
        }

        .step.active{
            opacity:1;
            transform:translate(-50%,0);
            pointer-events:auto;
        }

        .btn{
            display:inline-flex;
            align-items:center;
            gap:10px;
            background:linear-gradient(90deg,var(--accent-from),var(--accent-to));
            color:#fff;
            padding:12px 22px;
            border-radius:999px;
            border:0;
            cursor:pointer;
            font-weight:700;
            box-shadow:0 6px 20px rgba(236,72,153,0.18);
            transition:transform .18s ease, box-shadow .18s ease;
        }

        .btn:hover{ transform:translateY(-3px); box-shadow:0 10px 30px rgba(236,72,153,0.22); }
        .btn:active{ transform:translateY(0); }

        .text-gradient{
            background:linear-gradient(90deg,var(--accent-from),#f59e0b);
            -webkit-background-clip:text;
            background-clip:text;
            color:transparent;
        }

        .emoji{ font-size:3rem; display:inline-block; margin-bottom:10px; }

        .reason-card{
            background:#fff;
            border-radius:14px;
            padding:18px;
            box-shadow:0 8px 30px rgba(2,6,23,0.04);
        }

        #progress-container{
            position:fixed;
            top:20px;
            left:50%;
            transform:translateX(-50%);
            width:84%;
            max-width:420px;
            height:7px;
            background:rgba(255,255,255,0.35);
            border-radius:999px;
            z-index:40;
            box-shadow:0 4px 14px rgba(2,6,23,0.06);
        }
        #progress-bar{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent-from),var(--accent-to)); border-radius:999px; transition: width .45s ease; }

        /* larger audio control */
        #audio-toggle{
            position:fixed;
            top:16px;
            right:16px;
            z-index:60;
            padding:12px 16px;
            border-radius:12px;
            display:flex;
            align-items:center;
            gap:10px;
            font-size:15px;
        }

        /* responsive tweaks */
        @media (max-width:640px){
            .step{ padding:20px; border-radius:16px; max-width:92%; }
            .emoji{ font-size:2.6rem; }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="canvas-container"></div>

        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>

        <div id="content">
            <!-- Step 1: Initial Reveal -->
            <div class="step active" id="step1">
                <div class="emoji heart-beat">‚ù§Ô∏è</div>
                <h1 class="text-4xl md:text-5xl font-bold mb-6 text-gradient">iloilo girl</h1>
                <p class="text-xl text-gray-700 mb-8">I made something special for you...</p>
                <button class="btn" id="start-btn">iclick mo to</button>
            </div>

            <!-- Step 2: Birthday Message -->
            <div class="step" id="step2">
                <div class="emoji">üéâ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">Happy Birthday!</h2>
                <p class="text-lg text-gray-700 mb-6">
                    Happy birthday tols, sana sumaya ang araw mo legit oo. If hindi mo pa nac-click, meron akong
                    nilagay na audio ha BWHAHAAHAAHAHAHA. Sige na, i next mo na.
                </p>
                <button class="btn" id="next-btn-2">i-click ang button</button>
            </div>

            <!-- Step 3: Reasons You're Amazing -->
            <div class="step" id="step3">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gradient">Mga thoughts ko sayo:</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="reason-card">
                        <div class="emoji text-3xl">‚ú®</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Music Taste</h3>
                        <p class="text-gray-700">Ganda ng music taste mo erp, first time na someone matched with my music take legit.</p>
                    </div>
                    <div class="reason-card">
                        <div class="emoji text-3xl">üòä</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Humor</h3>
                        <p class="text-gray-700">Eguls sayo erp, matsalove nalang talaga, basta kasama ka sa paglipad ng eroplano ko.</p>
                    </div>
                    <div class="reason-card">
                        <div class="emoji text-3xl">üåü</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">You as a person</h3>
                        <p class="text-gray-700">Wala lang, ang cool mo lang BWHAHAHAHAH de ano, you are fun to talk with.</p>
                    </div>
                </div>
                <button class="btn" id="next-btn-3">i click mo to</button>
            </div>

            <!-- Step 4: Memory Lane -->
            <div class="step" id="step4">
                <div class="emoji">üì∏</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">what's this?</h2>
                <div class="bg-gradient-to-r from-pink-200 to-rose-200 rounded-xl p-8 mb-8 flex flex-col justify-center items-center">
                    <img src="pusangmusic.jpg" height="200" width="200" alt="" srcset="">
                    <p class="text-lg text-gray-700 italic mt-2">pusang nakikinig sa music</p>
                </div>
                <p class="text-lg text-gray-700 mb-6">
                    So, first time ko maggawa ng playlist to somebody, kaya ewan, nilagay ko nalang lahat ng fav music ko dun. I listen to all of it
                    and dadagdagan ko pa yon, so, sana magustuhan mo lolz.
                </p>
                <button class="btn" id="next-btn-4">One Last Thing</button>
            </div>

            <!-- Step 5: Final Wish -->
            <div class="step" id="step5">
                <div class="emoji">üéÇ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">My Birthday Wish For You</h2>
                <p class="text-lg text-gray-700 mb-8">
                    May all your wish come true. Kahit ano payan basta wala kang inaapakang tao. Tigilan narin ang kakakape, baka magpalpitate
                    ka pa BWHAHAHAAHAHAHA. Stay safe palagi and ALWAYS ray kay papa rold. May you heal from things you don't talk about. 
                    May you get everything that you always wanted. 
                </p>
                <p class="text-xl font-semibold text-pink-600 mb-8">
                    Happy Birthday, Jheneicah! ‚ù§Ô∏è
                </p>
                <button class="btn" id="confetti-btn">Click mo to! May effect na maangas.</button>
                <p class="mt-8 text-gray-500">made with chatgpt and openai BWHAAHAHAHAAAHAHA joke, made with sipag and tiyaga sa vscode and github</p>
            </div>
        </div>

        <!-- background and step audio elements -->
        <audio id="bg-audio" src="abba.mp3" preload="auto" loop></audio>
        <audio id="pluto-audio" src="pluto.mp3" preload="auto"></audio>

        <!-- audio toggle UI (restored design) -->
        <button id="audio-toggle" class="btn" aria-label="toggle audio">
            <span id="audio-toggle-icon">üîà</span>
            <span id="audio-toggle-text">click this to turn on audio</span>
        </button>
    </div>

    <script>
        // -- three.js background (kept original) --
        const container = document.getElementById('canvas-container');
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 30;

        const heartShape = new THREE.Shape();
        heartShape.moveTo(0.5,0.5);
        heartShape.bezierCurveTo(0.5,0.5,1,0,0,0);
        heartShape.bezierCurveTo(-1,0,-1,1.5,-1,1.5);
        heartShape.bezierCurveTo(-1,2.5,0.5,3.5,0.5,3.5);
        heartShape.bezierCurveTo(0.5,3.5,2,2.5,2,1.5);
        heartShape.bezierCurveTo(2,1.5,2,0,1,0);
        heartShape.bezierCurveTo(0.5,0,0.5,0.5,0.5,0.5);

        const extrudeSettings = { depth:0.5, bevelEnabled:true, bevelSegments:3, bevelSize:0.2, bevelThickness:0.3 };
        const heartGeometry = new THREE.ExtrudeGeometry(heartShape, extrudeSettings);

        const hearts = [];
        const colors = [0xff6b6b,0xff8e8e,0xffb3b3,0xffd8d8,0xff9e9e,0xffc1c1,0xff6b8e,0xff8eb3];

        for(let i=0;i<25;i++){
            const material = new THREE.MeshPhongMaterial({ color: colors[Math.floor(Math.random()*colors.length)], emissive:0xff0000, emissiveIntensity:0.08, shininess:80, transparent:true, opacity:0.95 });
            const heart = new THREE.Mesh(heartGeometry, material);
            heart.position.x = (Math.random()-0.5)*50;
            heart.position.y = (Math.random()-0.5)*50;
            heart.position.z = (Math.random()-0.5)*50;
            const s = Math.random()*0.8 + 0.5;
            heart.scale.set(s,s,s);
            heart.rotation.x = Math.random()*Math.PI;
            heart.rotation.y = Math.random()*Math.PI;
            heart.userData = {
                speedX: Math.random()*0.02-0.01,
                speedY: Math.random()*0.02-0.01,
                speedZ: Math.random()*0.02-0.01,
                rotationSpeedX: Math.random()*0.01,
                rotationSpeedY: Math.random()*0.01,
                originalX: heart.position.x,
                originalY: heart.position.y,
                originalZ: heart.position.z,
                floatDistance: 2 + Math.random()*3
            };
            scene.add(heart);
            hearts.push(heart);
        }

        scene.add(new THREE.AmbientLight(0xffffff,0.5));
        const dir = new THREE.DirectionalLight(0xffffff,0.8);
        dir.position.set(1,1,1);
        scene.add(dir);

        function animate(){ requestAnimationFrame(animate);
            const t = Date.now() * 0.001;
            hearts.forEach(h=>{
                h.position.x = h.userData.originalX + Math.sin(t * h.userData.speedX * 10) * h.userData.floatDistance;
                h.position.y = h.userData.originalY + Math.sin(t * h.userData.speedY * 10) * h.userData.floatDistance;
                h.position.z = h.userData.originalZ + Math.sin(t * h.userData.speedZ * 10) * h.userData.floatDistance;
                h.rotation.x += h.userData.rotationSpeedX;
                h.rotation.y += h.userData.rotationSpeedY;
            });
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', ()=>{ camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

        // -- Step navigation & UI logic (restored & preserved) --
        let currentStep = 1;
        const totalSteps = 5;

        function updateProgressBar(){
            const p = ((currentStep-1)/(totalSteps-1))*100;
            document.getElementById('progress-bar').style.width = `${p}%`;
        }

        // audio elements & controls
        const bgAudio = document.getElementById('bg-audio'); // abba
        const plutoAudio = document.getElementById('pluto-audio'); // pluto
        const audioToggle = document.getElementById('audio-toggle');
        const audioIcon = document.getElementById('audio-toggle-icon');
        const audioLabel = document.getElementById('audio-toggle-text');
        if(bgAudio) bgAudio.volume = 0.6;
        let audioStarted = false;
        window.__plutoTimeout = window.__plutoTimeout || null;
        const PLUTO_PLAY_MS = 200000; // 3 minutes 20 seconds

        function setAudioUI(state){
            if(!audioIcon || !audioLabel) return;
            if(state === 'playing'){ audioIcon.textContent='üîä'; audioLabel.textContent='click to mute audio'; }
            else { audioIcon.textContent='üîà'; audioLabel.textContent='click this to turn on audio'; }
        }

        function startAudioOnce(){
            if(audioStarted || !bgAudio) return;
            bgAudio.currentTime = 0;
            bgAudio.play().then(()=>{ audioStarted = true; setAudioUI('playing'); }).catch(()=>{ setAudioUI('paused'); });
        }

        // helper to stop pluto safely
        function stopPluto(){
            if(!plutoAudio) return;
            try{ plutoAudio.pause(); plutoAudio.currentTime = 0; }catch{}
            if(window.__plutoTimeout){ clearTimeout(window.__plutoTimeout); window.__plutoTimeout = null; }
        }

       // ...existing code...
        // showStep: restores UI classes and handles audio behavior:
        function showStep(stepNumber){
            // hide all
            document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
            const el = document.getElementById(`step${stepNumber}`);
            if(el) el.classList.add('active');

            currentStep = stepNumber;
            updateProgressBar();

            // visual highlight for final step
            if(stepNumber === totalSteps){
                const cb = document.getElementById('confetti-btn');
                if(cb) cb.classList.add('animate-pulse');
            }

            // audio behavior:
            // - bgAudio plays on steps 1..4 (if started) and pauses on step 5
            // - plutoAudio plays only on step 5 and should stop after exactly 3:20 (200000ms)
            if(window.__plutoTimeout){ clearTimeout(window.__plutoTimeout); window.__plutoTimeout = null; }

            try{
                if(stepNumber === 5){
                    // pause background
                    if(bgAudio && !bgAudio.paused){ try{ bgAudio.pause(); }catch{} }

                    if(plutoAudio){
                        const START_SEC = 200; // 3:20 -> 200 seconds

                        // helper to schedule stop after PLUTO_PLAY_MS once playback actually started
                        function scheduleStopAfterPlay(playPromise){
                            if (playPromise && typeof playPromise.then === 'function') {
                                playPromise.then(()=>{
                                    if(window.__plutoTimeout) clearTimeout(window.__plutoTimeout);
                                    window.__plutoTimeout = setTimeout(()=>{ stopPluto(); }, PLUTO_PLAY_MS);
                                }).catch(()=>{
                                    // playback blocked until user gesture; don't schedule
                                });
                            } else {
                                // older browsers: assume play started
                                if(window.__plutoTimeout) clearTimeout(window.__plutoTimeout);
                                window.__plutoTimeout = setTimeout(()=>{ stopPluto(); }, PLUTO_PLAY_MS);
                            }
                        }

                        // Try to set currentTime; if metadata not loaded, wait for loadedmetadata
                        try {
                            plutoAudio.currentTime = START_SEC;
                            const playPromise = plutoAudio.play();
                            scheduleStopAfterPlay(playPromise);
                        } catch (err) {
                            // metadata not ready or setting currentTime failed ‚Äî wait for loadedmetadata
                            const onMeta = () => {
                                plutoAudio.removeEventListener('loadedmetadata', onMeta);
                                try { plutoAudio.currentTime = START_SEC; } catch(e){}
                                const playPromise = plutoAudio.play();
                                scheduleStopAfterPlay(playPromise);
                            };
                            plutoAudio.addEventListener('loadedmetadata', onMeta);

                            // also attempt to play now (some browsers will prompt and then loadedmetadata will fire)
                            try {
                                const playPromise = plutoAudio.play();
                                // don't schedule stop here; schedule when play actually begins in promise resolution above
                                if (playPromise && typeof playPromise.then === 'function') {
                                    playPromise.catch(()=>{/* likely blocked until gesture */});
                                }
                            } catch(e){}
                        }
                    }
                } else {
                    // leaving step 5: stop pluto and resume bg if previously started
                    stopPluto();
                    if(bgAudio && audioStarted){
                        bgAudio.play().catch(()=>{ /* ignore */ });
                        setAudioUI('playing');
                    }
                }
            }catch(e){
                // silent
            }
        }
// ...existing code...

        // button listeners (restored behavior)
        document.getElementById('start-btn').addEventListener('click', ()=>{
            currentStep = 2;
            showStep(currentStep);
            startAudioOnce();
        });

        document.getElementById('next-btn-2').addEventListener('click', ()=>{
            currentStep = 3; showStep(currentStep);
        });

        document.getElementById('next-btn-3').addEventListener('click', ()=>{
            currentStep = 4; showStep(currentStep);
        });

        document.getElementById('next-btn-4').addEventListener('click', ()=>{
            currentStep = 5; showStep(currentStep);
        });

        // confetti button (restored)
        document.getElementById('confetti-btn').addEventListener('click', ()=>{
            confetti({ particleCount:150, spread:70, origin:{y:0.6}, colors:['#ff0000','#ff69b4','#ff1493','#ffc0cb'] });
            setTimeout(()=>{ confetti({ particleCount:30, spread:60, origin:{y:0.5}, shapes:['heart'], colors:['#ff0000','#ff69b4'] }); }, 300);
            setTimeout(()=>{
                confetti({ particleCount:20, angle:60, spread:55, origin:{x:0}, shapes:['heart'], colors:['#ff0000','#ff69b4'] });
                confetti({ particleCount:20, angle:120, spread:55, origin:{x:1}, shapes:['heart'], colors:['#ff0000','#ff69b4'] });
            }, 600);

            hearts.forEach(h=>{
                gsap.to(h.position, { y: h.position.y - 30, duration:3, ease:"power1.out" });
                gsap.to(h.material, { opacity:0, duration:3, ease:"power1.out" });
            });
        });

        // audio toggle (controls background audio only)
        audioToggle.addEventListener('click', ()=>{
            if(!bgAudio) return;
            if(bgAudio.paused){
                bgAudio.play().then(()=>{ audioStarted=true; setAudioUI('playing'); }).catch(()=> setAudioUI('paused'));
            } else {
                bgAudio.pause(); setAudioUI('paused');
            }
        });

        // try to start bgAudio on first gesture
        ['click','touchstart','keydown'].forEach(evt=>{
            window.addEventListener(evt, startAudioOnce, { once:true, passive:true });
        });

        // initialize ui
        updateProgressBar();
    </script>
</body>
</html>
